---
layout: post
title: Selenium으로 네이버에서 크보 중계 데이터 긁어오기 1
date: 2025-06-09 17:22 +0900
category: [KBO, 중계긁기]
tags: [KBO, 스크래핑]
---

일단 해볼건 네이버 스포츠 중계페이지에서 KBO 경기 중계 데이터를 긁어오는 작업이다. 예전에 대충 만들어놨다가 유기했었는데, 짜놓은 코드 다시 살펴보면서 복습을 해보려 한다.

일단은 네이버 중계 페이지 구조에서 어디서 어떤 데이터를 긁어올건가부터 시작해보자.

![문자중계](/assets/img/post_img/Selenium_1/문자중계.png)
_구속, 구종, 타격결과를 포함한 문자중계데이터_

![투구위치](/assets/img/post_img/Selenium_1/문자중계_투구위치.png)
_투구된 위치를 보여주는 화면_

주로 긁어오고 싶은 데이터는 문자중계 데이터에 있는 구속, 구종, 타격결과 그리고 투구위치이다. 특히 투구위치같은 경우는 중계데이터를 네이버에서 긁어오기로 결정한 중요한 이유이다. (네이버의 robots.txt는 메인 외 모든 페이지를 허용하고 있지 않는데 뭐 개인적으로만 쓸 거니 괜찮지 않을까...하는 마음가짐으로...)

데이터를 긁기 위해 브라우저 개발자 도구를 열어서 좀 살펴보다 보면 중계 페이지는 동적 웹 페이지임을 알 수 있다. 덕분에 웹에서 데이터를 얻을때 흔히 사용되는 BeautifulSoup는 사용할 수 없고, Selenium을 이용하게 되었다.

그렇게 html 소스를 살펴보면 글자로 적혀있는 정보들은 html 안에서 찾아낼 수 있지만 투구정보는 단순히 canvas기능으로 그리고 있음을 알 수 있다. 즉, html상에서는 투구 위치정보를 알 수가 없다는 것. 그러면 투구위치 정보는 포기할 수 밖에 없는 건가?라고 생각했지만 다행히 그렇지는 않았다. 브레이크 포인트 걸고 열심히 코드 돌아가는걸 보기도 하고 핸드폰을 이용해서 인터넷 연결을 끊었다 연결했다 하면서 좀 실험해본 결과 이 중계 페이지는 이닝을 변경할때 그 이닝의 데이터를 받아서 정보를 뿌린다는 사실을 알게되었다. 그렇다면 이닝 변경시 데이터 파일을 받아올테니 그걸 활용할 수 있다!

그래서 개발자도구의 네트워크 탭을 열어둔 뒤 중계 페이지의 이닝을 변경해보면 변경할때마다 선수사진과 함께 relay?inning=n 이라는 json 파일(n은 이닝 숫자)을 받아오는 것을 볼 수 있다. 이 json 파일을 열어보면 되게 복잡하긴 하지만 중계페이지에 필요한 정보들이 있다는 것을 볼 수있다. 특히 중요한것은 PTS데이터로 추정되는 데이터들이 있다는 사실이다.

![PTS_데이터](/assets/img/post_img/Selenium_1/pts데이터.png)
_이닝 데이터 json파일에 있는 PTS 데이터_

몇 가지 항목이 있는데 보기만 해도 뭔지 딱 감이 오는 항목은 밑쪽에 있는 9가지, "vy0" 부터 "az"까지다. 당연히 xyz축 방향의 속도(vx, vy, vz), 위치 (x, y, z), 가속도(ax, ay, az)일 것이고, 0라는 것은 측정시작지점일 터이다. 숫자들이 되게 이상하다고 느껴졌는데, 이 숫자들의 힌트는 PTS에 대해 설명한 한 네이버 블로그(https://m.blog.naver.com/ipracc/221558244446)에서 찾아볼 수 있었다.

PTS는 PITCH f/x에 기반을 두고 있으며, PITCH f/x는 홈에서 약 50ft 위치에서 투구 정보를 측정한다고 한다. 50이라는 숫자는 네이버에서 얻은 PTS데이터에서도 "y0"의 값으로 나온다. 즉 이 숫자들은 ft단위로 쓰여진 숫자이다. 야드파운드법은 좀 그렇기 때문에 나중에 데이터 가공할때는 싸그리 미터법으로 바꿔주자.

여하간 우리가 긁어올 데이터는 바로 이 이닝별 json 파일이다. 기본 Seleinum은 네트워크 기능을 지원하지 않기 때문에 이 데이터를 얻기 위해서는 Selenium-wire를 사용해주어야 한다.

일단 이번 글에서는 여기까지만 써놓고, 전에 써둔 코드를 정리해서 다음 포스트에서 계속 진행을 해보도록 하겠다.